"use strict";function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a;}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a;}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a;};!function(){for(var a=["DocumentType","Element","CharacterData"],b=function(){null!=this.parentNode&&this.parentNode.removeChild(this);},c=0;c<a.length;c++){var d=a[c];window[d]&&!window[d].prototype.remove&&(window[d].prototype.remove=b);}}(),function(b){function c(){}function f(a,b){return function(){a.apply(b,arguments);};}function g(a){if("object"!==_typeof(this))throw new TypeError("Promises must be constructed via new");if("function"!=typeof a)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],l(a,this);}function h(a,b){for(;3===a._state;)a=a._value;return 0===a._state?void a._deferreds.push(b):(a._handled=!0,void g._immediateFn(function(){var c=1===a._state?b.onFulfilled:b.onRejected;if(null===c)return void(1===a._state?j:k)(b.promise,a._value);var d;try{d=c(a._value);}catch(a){return void k(b.promise,a);}j(b.promise,d);}));}function j(a,b){try{if(b===a)throw new TypeError("A promise cannot be resolved with itself.");if(b&&("object"===("undefined"==typeof b?"undefined":_typeof(b))||"function"==typeof b)){var c=b.then;if(b instanceof g)return a._state=3,a._value=b,void i(a);if("function"==typeof c)return void l(f(c,b),a);}a._state=1,a._value=b,i(a);}catch(b){k(a,b);}}function k(a,b){a._state=2,a._value=b,i(a);}function i(a){2===a._state&&0===a._deferreds.length&&g._immediateFn(function(){a._handled||g._unhandledRejectionFn(a._value);});for(var b=0,c=a._deferreds.length;b<c;b++)h(a,a._deferreds[b]);a._deferreds=null;}function a(a,b,c){this.onFulfilled="function"==typeof a?a:null,this.onRejected="function"==typeof b?b:null,this.promise=c;}function l(a,b){var c=!1;try{a(function(a){c||(c=!0,j(b,a));},function(a){c||(c=!0,k(b,a));});}catch(a){if(c)return;c=!0,k(b,a);}}var m=setTimeout;g.prototype["catch"]=function(a){return this.then(null,a);},g.prototype.then=function(b,d){var e=new this.constructor(c);return h(this,new a(b,d,e)),e;},g.all=function(a){var b=Array.prototype.slice.call(a);return new g(function(c,d){function a(f,g){try{if(g&&("object"===("undefined"==typeof g?"undefined":_typeof(g))||"function"==typeof g)){var h=g.then;if("function"==typeof h)return void h.call(g,function(b){a(f,b);},d);}b[f]=g,0===--e&&c(b);}catch(a){d(a);}}if(0===b.length)return c([]);for(var e=b.length,f=0;f<b.length;f++)a(f,b[f]);});},g.resolve=function(a){return a&&"object"===("undefined"==typeof a?"undefined":_typeof(a))&&a.constructor===g?a:new g(function(b){b(a);});},g.reject=function(a){return new g(function(b,c){c(a);});},g.race=function(a){return new g(function(b,c){for(var d=0,e=a.length;d<e;d++)a[d].then(b,c);});},g._immediateFn="function"==typeof setImmediate&&function(a){setImmediate(a);}||function(a){m(a,0);},g._unhandledRejectionFn=function(a){"undefined"!=typeof console&&console&&void 0;},g._setImmediateFn=function(a){g._immediateFn=a;},g._setUnhandledRejectionFn=function(a){g._unhandledRejectionFn=a;},"undefined"!=typeof module&&module.exports?module.exports=g:b.Promise||(b.Promise=g);}(window),function(b){b.Promise||(b.Promise=Promise);var e="required",j="email",i="minLength",p="maxLength",n="password",o="zip",q="phone",a="remote",l="strength",r="function",g=function(a,b){if("string"==typeof a)return a;var c="post"===b.toLowerCase()?"":"?";return Array.isArray(a)?c+a.map(function(a){return a.name+"="+a.value;}).join("&"):c+Object.keys(a).map(function(b){return b+"="+a[b];}).join("&");},c=function(b){var c=b.url,e=b.method,f=b.data,h=b.debug,i=b.callback,j=b.error;if(h)return void i("test");var k=b.async!==!1,a=new XMLHttpRequest(),l=g(f,"get"),m=null;"post"===e.toLowerCase()&&(m=g(f,"post"),l=""),a.open(e,c+l,k),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){4===this.readyState&&(200===this.status?i(this.responseText):j&&j(this.responseText));},a.send(m);},d=function(a,b){this.options=b||{},this.rules=this.options.rules||{},this.messages=this.options.messages||void 0,this.colorWrong=this.options.colorWrong||"#B81111",this.result={},this.elements=[],this.tooltip=this.options.tooltip||{},this.tooltipFadeOutTime=this.tooltip.fadeOutTime||5e3,this.tooltipFadeOutClass=this.tooltip.fadeOutClass||"just-validate-tooltip-hide",this.tooltipSelectorWrap=document.querySelectorAll(this.tooltip.selectorWrap).length?document.querySelectorAll(this.tooltip.selectorWrap):document.querySelectorAll(".just-validate-tooltip-container"),this.bindHandlerKeyup=this.handlerKeyup.bind(this),this.submitHandler=this.options.submitHandler||void 0,this.invalidFormCallback=this.options.invalidFormCallback||void 0,this.promisesRemote=[],this.isValidationSuccess=!1,this.focusWrongField=this.options.focusWrongField||!1,this.REGEXP={email:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,zip:/^\d{5}(-\d{4})?$/,phone:/^([0-9]( |-)?)?(\(?[0-9]{3}\)?|[0-9]{3})( |-)?([0-9]{3}( |-)?[0-9]{4}|[a-zA-Z0-9]{7})$/,password:/[^\w\d]*(([0-9]+.*[A-Za-z]+.*)|[A-Za-z]+.*([0-9]+.*))/,strengthPass:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]/},this.DEFAULT_REMOTE_ERROR="Error",this.state={tooltipsTimer:null},this.setForm(document.querySelector(a));};d.prototype={defaultRules:{email:{required:!0,email:!0},name:{required:!0,minLength:3,maxLength:15},text:{required:!0,maxLength:300,minLength:5},password:{required:!0,password:!0,minLength:4,maxLength:8},zip:{required:!0,zip:!0},phone:{phone:!0}},defaultMessages:{required:"The field is required",email:"Please, type a valid email",maxLength:"The field must contain a maximum of :value characters",minLength:"The field must contain a minimum of :value characters",password:"Password is not valid",remote:"Email already exists",strength:"Password must contents at least one uppercase letter, one lowercase letter and one number","function":"Function returned false"},handlerKeyup:function(a){var b=a.target,c={name:b.getAttribute("data-validate-field"),value:b.value};delete this.result[c.name],this.validateItem({name:c.name,value:c.value,group:[],isKeyupChange:!0}),this.renderErrors();},setterEventListener:function(a,b,c,d){switch("keyup"===b&&(c=this.bindHandlerKeyup),d){case"add":a.addEventListener(b,c);break;case"remove":a.removeEventListener(b,c);}},getElementsRealValue:function(){for(var a=this.$form.querySelectorAll("*"),b=void 0,c={},d=0,e=a.length;d<e;++d)if(b=a[d].getAttribute("name")){if("checkbox"===a[d].type){c[b]=a[d].checked;continue;}c[b]=a[d].value;}return c;},validationFailed:function(){this.invalidFormCallback&&this.invalidFormCallback(this.result);var a=document.querySelector(".js-validate-error-field");this.focusWrongField&&a&&a.focus&&a.focus();},validationSuccess:function(){if(0===Object.keys(this.result).length){if(this.isValidationSuccess=!1,this.submitHandler){var a=this.getElementsRealValue();return void this.submitHandler(this.$form,a,c);}this.$form.submit();}},setForm:function(a){var b=this;this.$form=a,this.$form.setAttribute("novalidate","novalidate"),this.$form.addEventListener("submit",function(a){return a.preventDefault(),b.result=[],b.getElements(),b.promisesRemote.length?void Promise.all(b.promisesRemote).then(function(){b.promisesRemote=[],b.isValidationSuccess?b.validationSuccess():b.validationFailed();}):void(b.isValidationSuccess?b.validationSuccess():b.validationFailed());});},isEmail:function(a){return this.REGEXP.email.test(a);},isZip:function(a){return this.REGEXP.zip.test(a);},isPhone:function(a){return this.REGEXP.phone.test(a);},isPassword:function(a){return this.REGEXP.password.test(a);},isEmpty:function(a){var b=a;return a.trim&&(b=a.trim()),!b;},checkLengthMax:function(a,b){return a.length<=b;},checkLengthMin:function(a,b){return a.length>=b;},checkStrengthPass:function(a){return this.REGEXP.strengthPass.test(a);},getElements:function(){var b=this,c=this.$form.querySelectorAll("[data-validate-field]");this.elements=[];for(var a=function(d,e){var f=c[d],g=f.getAttribute("data-validate-field"),h=f.value,i=!1,j=[];if("checkbox"===f.type&&(h=f.checked||"",f.addEventListener("change",function(a){var c=a.target,d={name:c.getAttribute("data-validate-field"),value:c.checked};delete b.result[d.name],b.validateItem({name:d.name,value:d.value,group:[]}),b.renderErrors();})),"radio"===f.type){var k=b.elements.filter(function(a){if(a.name===g)return a;})[0];k?(k.group.push(f.checked),i=!0):j.push(f.checked),f.addEventListener("change",function(a){var c=a.target,d={name:c.getAttribute("data-validate-field"),value:c.checked};delete b.result[d.name],b.validateItem({name:d.name,value:d.value,group:[]}),b.renderErrors();});}b.setterEventListener(f,"keyup",b.handlerKeyup,"add"),i||b.elements.push({name:g,value:h,group:j});},d=0,e=c.length;d<e;++d)a(d,e);this.validateElements();},validateRequired:function(a){return!this.isEmpty(a);},validateEmail:function(a){return this.isEmail(a);},validatePhone:function(a){return this.isPhone(a);},validateMinLength:function(a,b){return this.checkLengthMin(a,b);},validateMaxLength:function(a,b){return this.checkLengthMax(a,b);},validateStrengthPass:function(a){return this.checkStrengthPass(a);},validatePassword:function(a){return this.isPassword(a);},validateZip:function(a){return this.isZip(a);},validateRemote:function(a){var b=a.value,d=a.name,f=a.url,g=a.successAnswer,h=a.sendParam,i=a.method;return new Promise(function(a){c({url:f,method:i,data:_defineProperty({},h,b),async:!0,callback:function(b){b.toLowerCase()===g.toLowerCase()&&a("ok"),a({type:"incorrect",name:d});},error:function(){a({type:"error",name:d});}});});},generateMessage:function(a,b,c){var d=this.messages||this.defaultMessages,e=d[b]&&d[b][a]||this.messages&&"string"==typeof this.messages[b]&&d[b]||this.defaultMessages[a]||this.DEFAULT_REMOTE_ERROR;c&&(e=e.replace(":value",c.toString())),this.result[b]={message:e};},validateElements:function(){var b=this;return this.lockForm(),this.elements.forEach(function(a){b.validateItem({name:a.name,value:a.value,group:a.group});}),this.promisesRemote.length?void Promise.all(this.promisesRemote).then(function(c){c.forEach(function(c){return"ok"===c?void b.renderErrors():("error"===c.type&&alert("Server error occured. Please try later."),b.generateMessage(a,c.name),void b.renderErrors());});}):void this.renderErrors();},validateItem:function(d){var s=this,c=d.name,h=d.group,f=d.value,m=d.isKeyupChange,t=this.rules[c]||this.defaultRules[c]||!1;if(t)for(var u in t){var g=t[u];if(u!==e&&u!==r&&""==f)return;switch(u){case r:if("function"!=typeof g)break;if(g(c,f))break;return void this.generateMessage(r,c,g);case e:if(!g)break;if(h.length){var v=!1;if(h.forEach(function(a){s.validateRequired(a)&&(v=!0);}),v)break;}else if(this.validateRequired(f))break;return void this.generateMessage(e,c);case j:if(!g)break;if(this.validateEmail(f))break;return void this.generateMessage(j,c);case i:if(!g)break;if(this.validateMinLength(f,g))break;return void this.generateMessage(i,c,g);case p:if(!g)break;if(this.validateMaxLength(f,g))break;return void this.generateMessage(p,c,g);case q:if(!g)break;if(this.validatePhone(f))break;return void this.generateMessage(q,c);case n:if(!g)break;if(this.validatePassword(f))break;return void this.generateMessage(n,c);case l:if(!g||"object"!==("undefined"==typeof g?"undefined":_typeof(g)))break;if(g["default"]&&this.validateStrengthPass(f))break;if(g.custom){var x=void 0;try{x=new RegExp(g.custom);}catch(a){x=this.REGEXP.strengthPass,void 0;}if(x.test(f))break;}return void this.generateMessage(l,c);case o:if(!g)break;if(this.validateZip(f))break;return void this.generateMessage(o,c);case a:if(m)break;if(!g)break;var w=g.url,k=g.successAnswer,y=g.method,z=g.sendParam,A=this.$form.querySelector('input[data-validate-field="'+c+'"]');return this.setterEventListener(A,"keyup",this.handlerKeyup,"remove"),void this.promisesRemote.push(this.validateRemote({name:c,value:f,url:w,method:y,sendParam:z,successAnswer:k}));}}},clearErrors:function(){for(var a=document.querySelectorAll(".js-validate-error-label"),b=0,c=a.length;b<c;++b)a[b].remove();a=document.querySelectorAll(".js-validate-error-field");for(var d=0,f=a.length;d<f;++d)a[d].classList.remove("js-validate-error-field"),a[d].style.border="",a[d].style.color="";},renderErrors:function(){var a=this;if(this.clearErrors(),this.unlockForm(),this.isValidationSuccess=!1,0===Object.keys(this.result).length)return void(this.isValidationSuccess=!0);for(var b in this.result){var c=this.result[b].message,d=this.$form.querySelectorAll('[data-validate-field="'+b+'"]'),e=d[d.length-1],f=document.createElement("div");if(f.innerHTML=c,f.className="js-validate-error-label",f.setAttribute("style","color: "+this.colorWrong),e.style.border="1px solid "+this.colorWrong,e.style.color=""+this.colorWrong,e.classList.add("js-validate-error-field"),"checkbox"===e.type||"radio"===e.type){var g=document.querySelector('label[for="'+e.getAttribute("id")+'"]');"label"===e.parentNode.tagName.toLowerCase()?e.parentNode.parentNode.insertBefore(f,null):g?g.parentNode.insertBefore(f,g.nextSibling):e.parentNode.insertBefore(f,e.nextSibling);}else e.parentNode.insertBefore(f,e.nextSibling);}this.tooltipSelectorWrap.length&&(this.state.tooltipsTimer=setTimeout(function(){a.hideTooltips();},this.tooltipFadeOutTime));},hideTooltips:function(){var a=this,b=document.querySelectorAll(".js-validate-error-label");b.forEach(function(b){b.classList.add(a.tooltipFadeOutClass);}),this.state.tooltipsTimer=null;},lockForm:function(){for(var a=this.$form.querySelectorAll("input, textarea, button, select"),b=0,c=a.length;b<c;++b)a[b].setAttribute("disabled","disabled"),a[b].style.pointerEvents="none",a[b].style.webitFilter="grayscale(100%)",a[b].style.filter="grayscale(100%)";},unlockForm:function(){for(var a=this.$form.querySelectorAll("input, textarea, button, select"),b=0,c=a.length;b<c;++b)a[b].removeAttribute("disabled"),a[b].style.pointerEvents="",a[b].style.webitFilter="",a[b].style.filter="";}},b.JustValidate=d;}(window);